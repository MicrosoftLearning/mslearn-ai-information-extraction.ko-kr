---
lab:
  title: 사용자 지정 Azure AI 문서 인텔리전스 모델을 사용하여 양식 분석
  description: 문서에서 특정 데이터를 추출하는 사용자 지정 문서 인텔리전스 모델을 만듭니다.
---

# 사용자 지정 Azure AI 문서 인텔리전스 모델을 사용하여 양식 분석

현재 기업이 직원에게 주문 시트를 수동으로 구매하고 데이터베이스에 데이터를 입력할 것을 요구한다고 가정합니다. AI 서비스를 활용하여 데이터 항목 프로세스를 개선하려고 합니다. 데이터베이스를 자동으로 업데이트하는 데 사용할 수 있는 구조적 데이터를 생성하고 양식을 읽는 기계 학습 모델을 빌드하기로 합니다.

**Azure AI 문서 인텔리전스**는 사용자가 자동화된 데이터 처리 소프트웨어를 빌드할 수 있게 해주는 Azure AI 서비스입니다. 이 소프트웨어는 OCR(광학 인식) 기술을 사용해 양식 문서에서 텍스트, 키/값 쌍 및 테이블을 추출할 수 있습니다. Azure AI 문서 인텔리전스에는 청구서, 영수증 및 명함을 인식하기 위한 사전 빌드된 모델이 있습니다. 이 서비스에서는 사용자 지정 모델을 학습시키는 기능도 제공합니다. 이 연습에서는 사용자 지정 모델 빌드 과정을 중점적으로 진행합니다.

이 연습은 Python을 기반으로 하지만 여러 언어별 SDK를 사용하여 유사한 애플리케이션을 개발할 수 있습니다. 포함 사항:

- [Python용 Azure AI 문서 인텔리전스 클라이언트 라이브러리](https://pypi.org/project/azure-ai-formrecognizer/)
- [Microsoft .NET용 Azure AI 문서 인텔리전스 클라이언트 라이브러리](https://www.nuget.org/packages/Azure.AI.FormRecognizer)
- [JavaScript용 Azure AI 문서 인텔리전스 클라이언트 라이브러리](https://www.npmjs.com/package/@azure/ai-form-recognizer)

이 연습에는 약 **30**분이 소요됩니다.

## Azure AI 문서 인텔리전스 리소스 만들기

Azure AI 문서 인텔리전스 서비스를 사용하려면 Azure 구독에 Azure AI 문서 인텔리전스 또는 Azure AI 서비스 리소스가 필요합니다. 여기서는 Azure Portal을 사용하여 리소스를 만듭니다.

1. 브라우저 탭에서 `https://portal.azure.com`에서 Azure Portal을 열고 Azure 구독과 연결된 Microsoft 계정으로 로그인합니다.
1. Azure Portal 홈페이지에서 상단 검색 상자로 이동하여 **문서 인텔리전스**를 입력한 다음 **Enter** 키를 누릅니다.
1. **문서 인텔리전스** 페이지에서 **만들기**를 선택합니다.
1. **문서 인텔리전스 만들기** 페이지에서 다음 설정을 사용하여 새 리소스를 만듭니다.
    - **구독**: Azure 구독.
    - **리소스 그룹**: 리소스 그룹을 만들거나 선택합니다
    - **지역**: 사용 가능한 모든 지역
    - **이름**: 문서 인텔리전스 리소스의 올바른 이름
    - **가격 책정 계층**: 무료 F0(*사용 가능한 무료 계층이 없으면* 표준 S0 선택).
1. 배포가 완료되면 **리소스로 이동**을 선택하여 리소스의 **개요** 페이지를 확인합니다.

## Cloud Shell 앱 개발 준비

Cloud Shell을 사용하여 텍스트 번역 앱을 개발합니다. 앱의 코드 파일은 GitHub 리포지토리에 제공되었습니다.

1. Azure Portal에서 페이지 상단의 검색 창 오른쪽에 있는 **[\>_]** 버튼으로 Azure Portal에서 새 Cloud Shell을 생성하고 ***PowerShell*** 환경을 선택합니다. Cloud Shell은 다음과 같이 Azure Portal 아래쪽 창에 명령줄 인터페이스를 제공합니다.

    > **참고**: 이전에 *Bash* 환경을 사용하는 Cloud Shell을 만든 경우 ***PowerShell***로 전환합니다.

1. 명령줄 콘솔과 Azure Portal 모두 볼 수 있도록 Cloud shell 창의 크기를 조정합니다. 두 창 간에 전환할 때는 분할줄을 사용하여 전환해야 합니다.

1. Cloud Shell 도구 모음의 **설정** 메뉴에서 **클래식 버전으로 이동**을 선택합니다(코드 편집기를 사용하는 데 필요).

    **<font color="red">계속하기 전에 Cloud Shell의 클래식 버전으로 전환했는지 확인합니다.</font>**

1. PowerShell 창에서 다음 명령을 입력하여 이 연습이 포함된 GitHub 리포지토리를 복제합니다.

    ```
   rm -r mslearn-ai-info -f
   git clone https://github.com/microsoftlearning/mslearn-ai-information-extraction mslearn-ai-info
    ```

    > **팁**: CloudShell에 명령을 붙여넣을 때, 출력이 화면 버퍼의 많은 부분을 차지할 수 있습니다. `cls` 명령을 입력해 화면을 지우면 각 작업에 더 집중할 수 있습니다.

1. 리포지토리가 복제된 후 애플리케이션 코드 파일이 포함된 폴더로 이동합니다.  

    ```
   cd mslearn-ai-info/Labfiles/custom-doc-intelligence
    ```

## 학습용 문서 수집

모델 테스트를 학습하려면 다음과 같은 샘플 양식을 사용합니다. 

![이번 프로젝트에 사용된 청구서 이미지입니다.](./media/Form_1.jpg)

1. 명령줄에서 `ls ./sample-forms`을(를) 실행하여 **sample-forms** 폴더의 콘텐츠를 나열합니다. 이 폴더에는 **.json** 및 **.jpg**로 끝나는 파일이 있습니다.

    **.jpg** 파일을 사용하여 해당 모델을 학습합니다.  

    **.json** 파일은 자동으로 생성되었고 레이블 정보가 포함됩니다. 파일은 양식과 함께 해당 Blob Storage 컨테이너에 업로드됩니다.

1. 아직 리소스의 **개요** 페이지가 없다면 **Azure Portal**에서 리소스의 해당 페이지로 이동합니다. *필수* 섹션에서 **리소스 그룹**, **구독 ID** 및 **위치**를 기록해 둡니다. 후속 단계에서 이러한 값이 필요합니다.
1. `code setup.sh` 명령을 실행하여 코드 편집기에서 **setup.sh**를 엽니다. 이 스크립트를 사용하여 필요한 기타 Azure 리소스를 만드는 데 필요한 Azure CLI(명령줄 인터페이스)를 실행합니다.

1. **setup.sh** 스크립트에서 명령을 검토합니다. 프로그램은 다음 작업을 수행합니다.
    - Azure 리소스 그룹에서 스토리지 계정 만들기
    - 로컬 *sampleforms* 폴더에서 스토리지 계정의 *sampleforms* 컨테이너로 파일 업로드
    - 공유 액세스 서명 URI 인쇄

1. 문서 인텔리전스 리소스를 배포한 구독, 리소스 그룹 및 위치 이름에 대한 적절한 값을 사용하여 **subscription_id**, **resource_group** 및 **location** 변수 선언을 수정합니다.

    > **중요**: **위치** 문자열에는 반드시 위치의 코드 버전을 사용하세요. 예를 들어, 위치가 "미국 동부"인 경우 스크립트의 문자열은 `eastus`이어야 합니다. Azure Portal의 리소스 그룹에 있는 **Essentials** 탭의 오른쪽에 있는 **JSON 보기** 단추를 클릭하면 해당 버전을 확인할 수 있습니다.

    **expiry_date** 변수가 과거 날짜인 경우 미래 날짜로 업데이트합니다. 이 변수는 SAS(공유 액세스 서명) URI를 생성할 때 사용됩니다. 실제로는 SAS에 적절한 만료 날짜를 설정해야 합니다. [여기](https://docs.microsoft.com/azure/storage/common/storage-sas-overview#how-a-shared-access-signature-works)서 SAS에 대해 자세히 알아볼 수 있습니다.  

1. 자리 표시자를 바꾼 후 코드 편집기에서 **CTRL+S** 명령 또는 **마우스 오른쪽 단추 클릭 > 저장**을 사용하여 변경 내용을 저장한 다음 **CTRL+Q** 명령 또는 **마우스 오른쪽 단추 클릭 > 종료**를 사용하여 Cloud Shell 명령줄을 열어둔 채 코드 편집기를 닫습니다.

1. 스크립트를 실행 가능하게 만들고 실행하려면 다음 명령을 입력하세요.

    ```PowerShell
   chmod +x ./setup.sh
   ./setup.sh
    ```

1. 스크립트가 완료되면 표시된 출력을 검토합니다.

1. Azure Portal에서 리소스 그룹을 새로 고쳐 방금 만든 Azure Storage 계정이 포함되어 있는지 확인합니다. 스토리지 계정을 열고 왼쪽 창에서 **스토리지 브라우저**를 선택합니다. 그런 다음 스토리지 브라우저에서 **Blob 컨테이너**를 확장하고 **sampleforms** 컨테이너를 선택하여 로컬 **custom-doc-intelligence/sample-forms** 폴더에서 파일이 업로드되었는지 확인합니다.

## 문서 인텔리전스 스튜디오를 사용하여 모델 학습

이제 스토리지 계정에 업로드된 파일을 사용하여 모델을 학습할 예정입니다.

1. 새 브라우저 탭을 열고 `https://documentintelligence.ai.azure.com/studio`의 Document Intelligence Studio로 이동합니다. 
1. **사용자 지정 모델** 섹션까지 아래로 스크롤하고 **사용자 지정 추출 모델** 타일을 선택합니다.
1. 메시지가 표시되면 Azure 자격 증명을 사용하여 로그인합니다.
1. 사용할 Azure AI 문서 인텔리전스 리소스를 묻는 메시지가 나타나면 Azure AI 문서 인텔리전스 리소스를 만들 때 사용한 구독 및 리소스 이름을 선택합니다.
1. **내 프로젝트**에서 다음 구성으로 새 프로젝트를 만듭니다.

    - **프로젝트 세부 정보 입력**:
        - **프로젝트 이름**: 프로젝트의 올바른 이름
    - **서비스 리소스 구성**:
        - **구독**: ‘Azure 구독’
        - **리소스 그룹**: 문서 인텔리전스 리소스를 배포한 리소스 그룹
        - **문서 인텔리전스 리소스** 문서 인텔리전스 리소스(*기본값으로 설정* 옵션 선택 및 기본 API 버전 사용)
    - **학습 데이터 원본 연결**:
        - **구독**: ‘Azure 구독’
        - **리소스 그룹**: 문서 인텔리전스 리소스를 배포한 리소스 그룹
        - **스토리지 계정**: 설치 스크립트에서 만든 스토리지 계정(기본* 옵션으로 설정 선택*, Blob 컨테이너 선택`sampleforms`, 폴더 경로 비워 두기)

1. 프로젝트가 만들어지면 페이지 오른쪽 상단에서 **학습**을 선택하여 모델을 학습합니다. 다음 구성을 사용합니다.
    - **모델 ID**: 모델의 유효한 이름(*다음 단계에서는 모델 ID 이름이 필요함*)
    - **빌드 모드**: 템플릿.
1. **모델로 이동**을 선택합니다.
1. 학습에는 다소 시간이 걸릴 수 있습니다. 상태가 **성공됨**이 될 때까지 기다리세요.

## 사용자 지정 문서 인텔리전스 모델 테스트

1. Azure Portal 및 Cloud shell이 포함된 브라우저 탭으로 돌아갑니다. 명령줄에서 다음 명령을 실행하여 애플리케이션 코드 파일이 포함된 폴더로 변경합니다.

    ```
    cd Python
    ```

1. 다음 명령을 실행하여 문서 인텔리전스 패키지를 설치합니다.

    ```
    python -m venv labenv
   ./labenv/bin/Activate.ps1
   pip install -r requirements.txt azure-ai-formrecognizer==3.3.3
    ```

1. 제공된 구성 파일을 편집하려면 다음 명령을 입력합니다.

    ```
   code .env
    ```

1. Azure Portal이 포함된 창에서 문서 인텔리전스 리소스의 **개요** 페이지에서 **키를 관리하려면 여기를 클릭하세요**를 선택하여 리소스의 엔드포인트 및 키를 확인하세요. 그런 다음, 다음 값으로 구성 파일을 편집합니다.
    - 문서 인텔리전스 엔드포인트
    - 문서 인텔리전스 키
    - 모델을 학습할 때 지정한 모델 ID

1. 자리 표시자를 바꾼 후 코드 편집기에서 **CTRL+S** 명령을 사용하여 변경 내용을 저장한 다음 **CTRL+Q** 명령을 사용하여 Cloud Shell 명령줄을 열어둔 채 코드 편집기를 닫습니다.

1. 클라이언트 애플리케이션의 코드 파일을 열고(C#의 경우 `code Program.cs`, Python의 경우 `code test-model.py`) 해당 코드에 포함된 내용을 검토합니다. 특히 URL의 이미지는 웹의 GitHub 리포지토리에 있는 파일입니다. 변경하지 않고 파일을 닫습니다.

1. 명령줄에서 다음 명령을 입력하여 프로그램을 실행합니다.

    ```
   python test-model.py
    ```

1. 출력을 보고 모델의 출력이 어떻게 `Merchant` 및 `CompanyPhoneNumber`와 같은 필드 이름을 제공하는지 관찰합니다.

## 정리

Azure 리소스 사용이 완료되면 추가 요금이 발생하지 않도록 [Azure Portal](https://portal.azure.com/?azure-portal=true)에서 리소스를 삭제해야 합니다.

## 자세한 정보

문서 인텔리전스 서비스에 대한 자세한 내용은 [문서 인텔리전스 설명서](https://learn.microsoft.com/azure/ai-services/document-intelligence/?azure-portal=true)를 참조하세요.
